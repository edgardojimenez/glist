(function(e){"use strict";function t(){return this.channels={},this}t.prototype.subscribe=function(t,n){if(void 0===t||void 0===n)throw new e.Error("Medium.subscribe(channel, listener): It should receive a channel and listener as paramaters.");return this.channels[t]=this.channels[t]||[],this.channels[t].push(n),this},t.prototype.publish=function(){var t,n,r=Array.prototype.slice.call(arguments,0),i=r.shift(),s=0;if(void 0===i)throw new e.Error("Medium.publish(channel, args): It should receive a channel as paramater.");if(n=this.channels[i],void 0!==n)for(t=n.length,s;t>s;s+=1)n[s].apply(this,r);return this},t.prototype.remove=function(t,n){if(void 0===t)throw new e.Error("Medium.remove(channel, listener): It should receive a channel as paramater.");var r=this.channels[t].length;if(void 0!==n)for(;r;)if(this.channels[t][r-=1]===n){this.channels[t].splice(r,1);break}return(void 0===n||0===this.channels[t].length)&&delete this.channels[t],this},"function"==typeof e.define&&void 0!==e.define.amd?e.define("medium",[],function(){return t}):"undefined"!=typeof module&&void 0!==module.exports?module.exports=t:e.Medium=t})(this),function(e){"use strict";e.GL=e.GL||{},e.GL.emitter=new e.Medium,e.GL.init=function(){e.GL.groceries.init(),e.GL.products.init()}}(window),function(e,t){"use strict";e.cache={groceries:t("#MPGroceries"),products:t("#MPProducts"),addProduct:t("#MPAddProduct"),confirm:t("#MPDialog"),error:t("#MPError"),showError:t("#show-error-page"),showDelete:t("#show-delete-page")}}(GL,jQuery),function(e,t){"use strict";function s(e){return n=r[e]}var n,r,i="localhost";r={production:{serverUrl:"http://mobws.azurewebsites.net",apiKey:"49492ABA-1F13-4E02-8ADC-1206FA203858",ttlMinutes:1},development:{serverUrl:"http://localhost:56665",apiKey:"23B5D06B-DC43-42A4-84E2-61A531736155",ttlMinutes:1},stage:{serverUrl:""}},t.location.hostname===i?n=r.development:n=r.production,e.config={setEnvironment:s,environment:n}}(GL,window),function(e,t){"use strict";function n(e){if(!t.localStorage)return;if(!e)return;return arguments.length>1?t.localStorage.getItem(e)||arguments[1]:t.localStorage.getItem(e)}function r(e,n){if(!t.localStorage)return;if(!e||!n)return;return t.localStorage.setItem(e,n)}function i(){t.localStorage.clear()}e.storage={get:n,set:r,clear:i}}(GL,window),function(e,t,n){"use strict";function i(){e.cache.showError.click()}function s(){var t=new Date(e.storage.get("ttl"));return!t||u(t,new Date)>e.config.environment.ttlMinutes?(o(),!1):!0}function o(){e.storage.clear(),e.emitter.publish("cleararray"),e.storage.set("ttl",new Date)}function u(e,t){var n=t.getTime()-e.getTime();return n/1e3/60}var r=function(){function r(e,t){this.id=n.observable(e),this.name=n.observable(t)}return r.prototype={removeGrocery:function(){e.emitter.publish("deletegrocery",this.id())},removeProduct:function(){e.emitter.publish("deleteproduct",this.id())},addToGrocery:function(){e.emitter.publish("addproducttogrocerylist",this)},toggleCheck:function(){t(arguments[1].currentTarget).find("img.on").toggle(),t(arguments[1].currentTarget).find("img.off").toggle()}},function(e,t){return new r(e,t)}}();e.common={productFactory:r,displayErrorDialog:i,isLocalStorageCacheValid:s}}(GL,jQuery,ko),function(e,t,n){"use strict";function i(){e.cache.groceries.bind("pageshow",function(){t("#body").removeClass("h"),t.mobile.showPageLoadingMsg();var n=r.groceryArray().length>0;e.repo.get("groceries",n).done(function(t){t&&t.length>0&&(o(t),u()),r.isDirty&&(e.cache.groceries.find("#listGrocery").listview("refresh"),r.isDirty=!1)}).fail(function(){e.common.displayErrorDialog()}).always(function(){t.mobile.hidePageLoadingMsg()})}),e.cache.groceries.find("#clear").click(function(){var i=e.cache.confirm.find("a#ok");i.off("click"),i.on("click",function(){t.mobile.showPageLoadingMsg(),e.repo.clearGroceries().done(function(){var t=[];n.utils.arrayForEach(r.groceryArray(),function(e){t.push(e)}),r.groceryArray.removeAll(),e.cache.groceries.find("#listGrocery").listview("refresh"),e.emitter.publish("returnproductsbacktolist",t),u(),e.cache.confirm.dialog("close")}).fail(function(){e.common.displayErrorDialog()}).always(function(){t.mobile.hidePageLoadingMsg()})}),e.cache.showDelete.click()}),n.applyBindings(r,e.cache.groceries.get(0)),e.emitter.subscribe("completeaddingproducttogrocerylist",s),e.emitter.subscribe("deletegrocery",function(n){t.mobile.showPageLoadingMsg(),e.repo.remove("groceries",n).done(function(){var t=r.groceryArray.remove(function(e){return e.id()===parseInt(n,10)});e.emitter.publish("moveproductbacktolist",t[0]),e.cache.groceries.find("#listGrocery").listview("refresh"),u()}).fail(function(){e.common.displayErrorDialog()}).always(function(){t.mobile.hidePageLoadingMsg()})}),e.emitter.subscribe("cleararray",function(){r.groceryArray.removeAll()})}function s(e){r.groceryArray.push(e),r.isDirty=!0,u()}function o(t){for(var n=0;n<t.length;n++)r.groceryArray.push(e.common.productFactory(t[n].id||t[n].productId,t[n].name||t[n].productName));r.isDirty=!0}function u(){e.repo.persist("gl.groceryarray",n.toJSON(r.groceryArray))}var r={groceryArray:n.observableArray(),setEmptyMessage:function(){return this.groceryArray().length===0?(this.isDirty=!0,"No items are on the lists"):""},isDirty:!1,showList:function(){return this.groceryArray().length>0}};e.groceries={init:i}}(GL,jQuery,ko),function(e,t,n){"use strict";function s(){e.cache.products.on("pageinit",function(){n.applyBindings(r,e.cache.products.get(0))}),e.cache.products.on("pageshow",function(){t("#body").removeClass("h"),t.mobile.showPageLoadingMsg();var n=r.productArray().length>0;e.repo.get("products",n).done(function(t){t&&t.length>0&&(a(t),p()),r.isDirty&&(e.cache.products.find("#listProduct").listview("refresh"),r.isDirty=!1)}).fail(function(){e.common.displayErrorDialog()}).always(function(){t.mobile.hidePageLoadingMsg()})}),e.cache.addProduct.on("pageinit",function(){t("#body").removeClass("h"),n.bindingHandlers.jqmChecked={init:function(e,r){if(e.type!="checkbox")return;var i=r();t(e).on("click",function(){n.utils.unwrapObservable(i)?i(!1):i(!0)})},update:function(e,r){if(e.type!="checkbox")return;var i=n.utils.unwrapObservable(r());if(i===undefined)return;i?t(e).prop("checked","checked").checkboxradio("refresh"):t(e).removeAttr("checked").checkboxradio("refresh")}},n.applyBindings(i,e.cache.addProduct.get(0))}),e.cache.addProduct.on("pageshow",function(){i.reset()}),e.emitter.subscribe("moveproductbacktolist",o),e.emitter.subscribe("returnproductsbacktolist",u),e.emitter.subscribe("deleteproduct",function(n){var i=e.cache.confirm.find("a#ok");i.off("click"),i.on("click",function(){t.mobile.showPageLoadingMsg(),e.repo.remove("products",n).done(function(){var t=r.productArray.remove(function(e){return e.id()===parseInt(n,10)});c(t[0]),e.cache.products.find("#listProduct").listview(),p(),e.cache.confirm.dialog("close")}).fail(function(){e.common.displayErrorDialog()}).always(function(){t.mobile.hidePageLoadingMsg()})}),e.cache.showDelete.click()}),e.emitter.subscribe("addproducttogrocerylist",function(n){t.mobile.showPageLoadingMsg(),e.repo.addProductToGroceryList(n).done(function(){var t=parseInt(n.id(),10),i=r.productArray.remove(function(e){return e.id()===t});c(i[0]),p(),e.emitter.publish("completeaddingproducttogrocerylist",i[0]),e.cache.products.find("#listProduct").listview("refresh")}).fail(function(){e.common.displayErrorDialog()}).always(function(){t.mobile.hidePageLoadingMsg()})}),e.emitter.subscribe("cleararray",function(){r.productArray.removeAll()})}function o(e){l(e),h(),r.isDirty=!0,p()}function u(e){n.utils.arrayForEach(e,function(e){l(e)}),h(),r.isDirty=!0,p()}function a(t){for(var n=0;n<t.length;n++)r.productArray.push(e.common.productFactory(t[n].id,t[n].name));r.isDirty=!0}function f(n,s){t.mobile.showPageLoadingMsg(),e.repo.addProductToProductList(n,s).done(function(t){var n;if(!t){e.common.displayErrorDialog();return}t.id>0?(n=e.common.productFactory(t.id,t.name),s?e.emitter.publish("completeaddingproducttogrocerylist",n):(l(n),h(),r.isDirty=!0,p()),i.message("Added product  '{0}'.".format(t.name))):t.id===-1&&i.message("Product  '{0}' exists.".format(t.name)),i.resetInputs(),p()}).fail(function(){e.common.displayErrorDialog()}).always(function(){t.mobile.hidePageLoadingMsg()})}function l(t){var i=t.name().substr(0,1).toUpperCase(),s=n.utils.arrayFirst(r.productArray(),function(e){return e.name().toUpperCase()===i});s||r.productArray.push(e.common.productFactory(-1,i)),r.productArray.push(t)}function c(e){var t=0,i=e.name().substr(0,1).toUpperCase();n.utils.arrayForEach(r.productArray(),function(e){e.name().substr(0,1).toUpperCase()===i&&t++}),t===1&&r.productArray.remove(function(e){return e.name()===i})}function h(){r.productArray.sort(function(e,t){return t.name().toLowerCase()>e.name().toLowerCase()?-1:t.name().toLowerCase()===e.name().toLowerCase()?0:1})}function p(){e.repo.persist("gl.productarray",n.toJSON(r.productArray))}var r={productArray:n.observableArray(),isDirty:!1,showList:function(){return this.productArray().length>0}},i={name:n.observable(""),addToList:n.observable(),message:n.observable(""),addProduct:function(){this.name().length>0?f(this.name(),this.addToList()):this.message("No product entered!")},reset:function(){this.name(""),this.message(""),this.addToList(!1)},resetInputs:function(){this.name("")}};e.products={init:s}}(GL,jQuery,ko),function(){String.prototype.format||Object.defineProperty(String.prototype,"format",{value:function(){var e=this,t=arguments.length;while(t--)e=e.replace(new RegExp("\\{"+t+"\\}","gm"),arguments[t]);return e},enumerable:!1})}(),$(document).on("mobileinit",function(){$.mobile.defaultDialogTransition="none",$.mobile.defaultPageTransition="none",GL.cache.groceries.on("pageinit",function(){GL.init()})})