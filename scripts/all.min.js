(function(e){"use strict";function t(){return this.channels={},this}t.prototype.subscribe=function(t,n){if(void 0===t||void 0===n)throw new e.Error("Medium.subscribe(channel, listener): It should receive a channel and listener as paramaters.");return this.channels[t]=this.channels[t]||[],this.channels[t].push(n),this},t.prototype.publish=function(){var t,n,r=Array.prototype.slice.call(arguments,0),i=r.shift(),s=0;if(void 0===i)throw new e.Error("Medium.publish(channel, args): It should receive a channel as paramater.");if(n=this.channels[i],void 0!==n)for(t=n.length,s;t>s;s+=1)n[s].apply(this,r);return this},t.prototype.remove=function(t,n){if(void 0===t)throw new e.Error("Medium.remove(channel, listener): It should receive a channel as paramater.");var r=this.channels[t].length;if(void 0!==n)for(;r;)if(this.channels[t][r-=1]===n){this.channels[t].splice(r,1);break}return(void 0===n||0===this.channels[t].length)&&delete this.channels[t],this},"function"==typeof e.define&&void 0!==e.define.amd?e.define("medium",[],function(){return t}):"undefined"!=typeof module&&void 0!==module.exports?module.exports=t:e.Medium=t})(this),function(){String.prototype.format||Object.defineProperty(String.prototype,"format",{value:function(){var e=this,t=arguments.length;while(t--)e=e.replace(new RegExp("\\{"+t+"\\}","gm"),arguments[t]);return e},enumerable:!1})}(),function(e){e.GL=e.GL||{},e.GL.emitter=new e.Medium}(window),function(e,t){"use strict";e.cache={groceries:t("#MPGroceries"),products:t("#MPProducts"),addProduct:t("#MPAddProduct"),confirm:t("#MPDialog"),error:t("#MPError"),showError:t("#show-error-page"),showDelete:t("#show-delete-page")}}(GL,jQuery),function(e,t){"use strict";function o(e){return n=r[e]}var n,r,i,s="glist.apphb.com";r={production:{serverUrl:"http://mobws.apphb.com"},development:{serverUrl:"http://mobws.apphb.com"},stage:{serverUrl:""}},t.location.hostname===s?n=r.production:n=r.development,e.config={setEnvironment:o,environment:n}}(GL,window),function(e,t){"use strict";function n(e){if(!t.localStorage)return;if(!e)return;return arguments.length>1?t.localStorage.getItem(e)||arguments[1]:t.localStorage.getItem(e)}function r(e,n){if(!t.localStorage)return;if(!e||!n)return;return t.localStorage.setItem(e,n)}e.storage={get:n,set:r}}(GL,window),function(e,t,n){"use strict";function i(){e.cache.showError.click()}function s(t,r){e.storage.set(t,n.toJSON(r))}function o(t,n,r){if(n().length>0)return!0;var i=JSON.parse(e.storage.get(t));return i&&i.length>0?(r(i),!0):!1}var r=function(){function r(e,t){this.id=n.observable(e),this.name=n.observable(t)}return r.prototype={removeGrocery:function(){e.emitter.publish("deletegrocery",this.id())},removeProduct:function(){e.emitter.publish("deleteproduct",this.id())},addToGrocery:function(){e.emitter.publish("addproducttogrocerylist",this)},toggleCheck:function(){t(arguments[1].currentTarget).find("img.on").toggle(),t(arguments[1].currentTarget).find("img.off").toggle()}},function(e,t){return new r(e,t)}}();e.common={productFactory:r,displayErrorDialog:i,persist:s,unPersist:o,getData:function(e){return t.mobile.showPageLoadingMsg(),t.ajax({type:e.action,url:e.url,dataType:"json",data:e.data}).fail(function(){i()})}}}(GL,jQuery,ko),function(e,t,n){"use strict";function i(i){e.cache.groceries.bind("pageshow",function(){t("#body").removeClass("h"),o(),r.isDirty&&(e.cache.groceries.find("#listGrocery").listview("refresh"),r.isDirty=!1)}),e.cache.groceries.find("#clear").click(function(){f()}),n.applyBindings(r,e.cache.groceries.get(0)),e.emitter.subscribe("completeaddingproducttogrocerylist",s),e.emitter.subscribe("deletegrocery",a)}function s(e){r.groceryArray.push(e),r.isDirty=!0,l()}function o(){if(e.common.unPersist("gl.groceryarray",r.groceryArray,u))return;return e.common.getData({url:e.config.environment.serverUrl+"/api/groceries",action:"GET"}).done(function(e){if(e.length===0)return;u(e),l()}).always(function(){t.mobile.hidePageLoadingMsg()})}function u(n){for(var i=0;i<n.length;i++)r.groceryArray.push(e.common.productFactory(n[i].id||n[i].productId,n[i].name||n[i].productName));t.mobile.activePage&&t.mobile.activePage.attr("id")===e.cache.groceries.attr("id")&&e.cache.groceries.find("#listGrocery").listview("refresh")}function a(n){return e.common.getData({url:e.config.environment.serverUrl+"/api/groceries/{0}".format(n),action:"DELETE"}).done(function(){var t=r.groceryArray.remove(function(e){return e.id()===parseInt(n,10)});e.emitter.publish("moveproductbacktolist",t[0]),e.cache.groceries.find("#listGrocery").listview("refresh"),l()}).always(function(){t.mobile.hidePageLoadingMsg()})}function f(){var i=e.cache.confirm.find("a#ok");i.off("click"),i.on("click",function(){return e.common.getData({url:e.config.environment.serverUrl+"/api/groceries",action:"DELETE"}).done(function(){var t=[];n.utils.arrayForEach(r.groceryArray(),function(e){t.push(e)}),r.groceryArray.removeAll(),e.cache.groceries.find("#listGrocery").listview("refresh"),e.emitter.publish("returnproductsbacktolist",t),l(),e.cache.confirm.dialog("close")}).always(function(){t.mobile.hidePageLoadingMsg()})}),e.cache.showDelete.click()}function l(){e.common.persist("gl.groceryarray",r.groceryArray)}var r={groceryArray:n.observableArray(),setEmptyMessage:function(){return this.groceryArray().length===0?(this.isDirty=!0,"No items are on the lists"):""},isDirty:!1,showList:function(){return this.groceryArray().length>0}};e.groceries={init:i}}(GL,jQuery,ko),function(e,t,n){"use strict";function s(s){e.cache.products.bind("pageshow",function(){t("#body").removeClass("h"),a(),r.isDirty&&(e.cache.products.find("#listProduct").listview("refresh"),r.isDirty=!1)}),e.cache.addProduct.bind("pageshow",function(){i.reset()}),n.applyBindings(r,e.cache.products.get(0)),n.applyBindings(i,e.cache.addProduct.get(0)),e.emitter.subscribe("moveproductbacktolist",o),e.emitter.subscribe("returnproductsbacktolist",u),e.emitter.subscribe("deleteproduct",c),e.emitter.subscribe("addproducttogrocerylist",l)}function o(e){p(e),v(),r.isDirty=!0,m()}function u(e){n.utils.arrayForEach(e,function(e){p(e)}),v(),r.isDirty=!0,m()}function a(){t.mobile.showPageLoadingMsg();if(e.common.unPersist("gl.productarray",r.productArray,f)){t.mobile.hidePageLoadingMsg();return}return e.common.getData({url:e.config.environment.serverUrl+"/api/products",action:"GET"}).done(function(e){if(e.length===0)return;f(e),m()}).always(function(){t.mobile.hidePageLoadingMsg()})}function f(n){for(var i=0;i<n.length;i++)r.productArray.push(e.common.productFactory(n[i].id,n[i].name));t.mobile.activePage&&t.mobile.activePage.attr("id")===e.cache.products.attr("id")&&e.cache.products.find("#listProduct").listview("refresh")}function l(n){return e.common.getData({url:e.config.environment.serverUrl+"/api/groceries/{0}".format(n.id()),action:"GET"}).done(function(){var t=parseInt(n.id(),10),i=r.productArray.remove(function(e){return e.id()===t});d(i[0]),m(),e.emitter.publish("completeaddingproducttogrocerylist",i[0]),e.cache.products.find("#listProduct").listview("refresh")}).always(function(){t.mobile.hidePageLoadingMsg()})}function c(n){var i=e.cache.confirm.find("a#ok");i.off("click"),i.on("click",function(){return e.common.getData({url:e.config.environment.serverUrl+"/api/products/{0}".format(n),action:"DELETE"}).done(function(){var t=r.productArray.remove(function(e){return e.id()===parseInt(n,10)});d(t[0]),e.cache.products.find("#listProduct").listview(),m(),e.cache.confirm.dialog("close")}).always(function(){t.mobile.hidePageLoadingMsg()})}),e.cache.showDelete.click()}function h(n,s){return e.common.getData({url:e.config.environment.serverUrl+"/api/products",action:"POST",data:{name:n,addToList:s}}).done(function(t){var n;if(!t){e.common.displayErrorDialog();return}t.id>0&&(n=e.common.productFactory(t.id,t.name),s?e.emitter.publish("completeaddingproducttogrocerylist",n):(p(n),v(),r.isDirty=!0,m())),i.message("Added product  '{0}'.".format(t.name)),i.resetInputs(),m()}).always(function(){t.mobile.hidePageLoadingMsg()})}function p(t){var i=t.name().substr(0,1).toUpperCase(),s=n.utils.arrayFirst(r.productArray(),function(e){return e.name().toUpperCase()===i});s||r.productArray.push(e.common.productFactory(-1,i)),r.productArray.push(t)}function d(e){var t=0,i=e.name().substr(0,1).toUpperCase();n.utils.arrayForEach(r.productArray(),function(e){e.name().substr(0,1).toUpperCase()===i&&t++}),t===1&&r.productArray.remove(function(e){return e.name()===i})}function v(){r.productArray.sort(function(e,t){return t.name().toLowerCase()>e.name().toLowerCase()?-1:t.name().toLowerCase()===e.name().toLowerCase()?0:1})}function m(){e.common.persist("gl.productarray",r.productArray)}var r={productArray:n.observableArray(),isDirty:!1,showList:function(){return this.productArray().length>0}},i={name:n.observable(""),addToList:n.observable(!1),message:n.observable(""),addProduct:function(){this.name().length>0?h(this.name(),this.addToList()):this.message("No product entered!")},reset:function(){this.name(""),this.message(""),this.addToList(!1)},resetInputs:function(){this.name("")}};e.products={init:s}}(GL,jQuery,ko),function(e,t){"use strict";function r(){return n.initAllPages.apply(this,arguments)}var n={initGroceriesPage:function(){var n=t.extend({},arguments[0]);e.groceries.init(n)},initProductsPage:function(){var n=t.extend({},arguments[0]);e.products.init(n)},initAllPages:function(){n.initGroceriesPage(arguments[0]),n.initProductsPage(arguments[0])}};e.main={init:r}}(GL,jQuery),$(document).on("mobileinit",function(){$.mobile.defaultDialogTransition="none",$.mobile.defaultPageTransition="none",GL.cache.groceries.on("pageinit",function(){GL.main.init()})})